import streamlit as st
import matplotlib.pyplot as plt

# Fungsi untuk menghitung batas kafein harian
def hitung_kafein_ideal(berat_badan_kg, usia, jenis_kelamin, konsumsi_kafein_mg):
    if usia < 12:
        batas_kafein_per_kg = 2.5
    elif usia < 18:
        batas_kafein_per_kg = 3.0
    else:
        batas_kafein_per_kg = 5.0 if berat_badan_kg * 5.0 <= 400 else 400 / berat_badan_kg

    faktor_jenis_kelamin = 0.9 if jenis_kelamin.lower() == "wanita" else 1.0
    batas_harian = berat_badan_kg * batas_kafein_per_kg * faktor_jenis_kelamin
    sisa_kafein = batas_harian - konsumsi_kafein_mg
    status = "Aman" if sisa_kafein >= 0 else "Berlebihan"
    
    return {
        "batas_harian_mg": batas_harian,
        "konsumsi_kafein_mg": konsumsi_kafein_mg,
        "sisa_kafein_mg": sisa_kafein,
        "status": status
    }

# Fungsi untuk membuat grafik
def buat_grafik(batas_harian, konsumsi_kafein):
    fig, ax = plt.subplots()
    kategori = ['Batas Harian', 'Konsumsi Kafein']
    nilai = [batas_harian, konsumsi_kafein]
    warna = ['green' if konsumsi_kafein <= batas_harian else 'red', 'blue']

    ax.bar(kategori, nilai, color=warna)
    ax.set_title('Perbandingan Konsumsi Kafein')
    ax.set_ylabel('Kafein (mg)')
    return fig

# Streamlit app
st.title("Kalkulator Kafein Harian")

# Input data pengguna
berat_badan = st.number_input("Masukkan berat badan (kg):", min_value=1.0, step=0.1)
usia = st.number_input("Masukkan usia (tahun):", min_value=1, step=1)
jenis_kelamin = st.selectbox("Pilih jenis kelamin:", ["Laki-laki", "Wanita"])

st.write("Masukkan jumlah konsumsi untuk setiap sumber kafein hari ini:")
# Input jumlah konsumsi untuk berbagai sumber kafein
kopi = st.number_input("Berapa cangkir kopi (240 ml):", min_value=0, step=1)
teh = st.number_input("Berapa cangkir teh hitam (240 ml):", min_value=0, step=1)
soda = st.number_input("Berapa kaleng soda (355 ml):", min_value=0, step=1)
coklat = st.number_input("Berapa gelas minuman coklat (240 ml):", min_value=0, step=1)

# Kandungan kafein per unit (dalam mg)
kafein_per_unit = {
    "kopi": 95,        # mg per cangkir
    "teh": 47,         # mg per cangkir
    "soda": 40,        # mg per kaleng
    "coklat": 20       # mg per gelas
}

# Total konsumsi kafein
kafein_kopi = kopi * kafein_per_unit["kopi"]
kafein_teh = teh * kafein_per_unit["teh"]
kafein_soda = soda * kafein_per_unit["soda"]
kafein_coklat = coklat * kafein_per_unit["coklat"]
total_kafein = kafein_kopi + kafein_teh + kafein_soda + kafein_coklat

# Tombol hitung
if st.button("Hitung"):
    if berat_badan > 0 and usia > 0:
        hasil = hitung_kafein_ideal(berat_badan, usia, jenis_kelamin, total_kafein)
        
        st.subheader("Hasil Kalkulator Kafein")
        st.write(f"**Batas Harian:** {hasil['batas_harian_mg']:.2f} mg")
        st.write(f"**Konsumsi Kafein:** {hasil['konsumsi_kafein_mg']} mg")
        st.write(f"**Sisa Batas Aman:** {hasil['sisa_kafein_mg']:.2f} mg")
        st.write(f"**Status:** {hasil['status']}")

        # Grafik
        st.subheader("Grafik Perbandingan Konsumsi")
        fig = buat_grafik(hasil['batas_harian_mg'], hasil['konsumsi_kafein_mg'])
        st.pyplot(fig)
    else:
        st.error("Mohon isi semua data dengan benar!")
